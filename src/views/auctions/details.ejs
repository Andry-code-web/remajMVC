<div class="auction-detail container-fluid">
  <div class="row">
    <div class="col-md-8">
      <div class="property-info card mb-4">
        <div class="card-body">
          <h2><%= auction.categoria.charAt(0).toUpperCase() + auction.categoria.slice(1) %> en <%= auction.ubicacion %></h2>
          
          <div class="current-bid" id="current-bid">
            Oferta Actual: S/. <%= auction.precios.toLocaleString() %>
          </div>
          
          <% if(auction.estado === 'en_curso') { %>
            <div class="bid-controls">
              <form id="bid-form" class="bid-form">
                <div class="input-group">
                  <input type="number" id="bid-amount" 
                         min="<%= auction.precios + 1000 %>" 
                         step="1000" 
                         class="form-control" 
                         placeholder="Ingrese su oferta">
                  <button type="submit" class="btn btn-primary">Ofertar</button>
                </div>
              </form>
              
              <form id="quick-bid-form" class="quick-bid-form">
                <button type="submit" class="btn btn-success w-100">
                  Oferta Rápida (+S/. 1,000)
                </button>
              </form>
            </div>

            <div class="progress-container">
              <div id="auction-progress" class="auction-progress"></div>
              <div id="countdown-display" class="countdown-display"></div>
            </div>
          <% } %>
          
          <div class="description">
            <%= auction.descripcion %>
          </div>
          
          <div class="features mt-4">
            <h3>Características</h3>
            <ul class="list-unstyled">
              <% if(auction.N_habitacion) { %>
                <li>Habitaciones: <%= auction.N_habitacion %></li>
              <% } %>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="chat-container">
        <div class="chat-header">
          <h3>Chat de la Subasta</h3>
          <div class="auction-status">
            <span class="status <%= auction.estado %>">
              <%= auction.statusMessage %>
            </span>
          </div>
        </div>
        
        <div class="chat-messages" id="chat-messages"></div>
        
        <form id="message-form" class="chat-input">
          <input type="text" id="message-input" 
                 placeholder="Escribe un mensaje..." 
                 <%= auction.estado !== 'en_curso' ? 'disabled' : '' %>>
          <button type="submit" <%= auction.estado !== 'en_curso' ? 'disabled' : '' %>>
            <i class="ri-send-plane-line"></i>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/css/auction.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/socket.io/socket.io.js"></script>
<script type="module">
  import AuctionChat from '/js/auction-chat.js';
  
  document.addEventListener('DOMContentLoaded', () => {
    const chat = new AuctionChat(
      '<%= auction.id %>', 
      '<%= user.id %>', 
      '<%= auction.precios %>'
    );
  });
</script>